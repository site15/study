# üß† –ß—Ç–æ —Ç–∞–∫–æ–µ RabbitMQ

**RabbitMQ** ‚Äî —ç—Ç–æ **message broker**, –∫–æ—Ç–æ—Ä—ã–π **–ø–æ—Å—Ä–µ–¥–Ω–∏–∫ –º–µ–∂–¥—É –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª–µ–º (producer) –∏ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–µ–º (consumer)**.

* Producer –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ ‚Üí RabbitMQ ‚Üí Consumer –∑–∞–±–∏—Ä–∞–µ—Ç.
* **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å** –∏ **–æ—Ç–≤—è–∑–∫–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤**.
* –†–µ–∞–ª–∏–∑—É–µ—Ç **–æ—á–µ—Ä–µ–¥–∏, –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –¥–æ—Å—Ç–∞–≤–∫–∏, –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—é**.

> –ò–¥–µ–∞–ª—å–Ω–æ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–æ–≤, —Ñ–æ–Ω–æ–≤—ã—Ö –∑–∞–¥–∞—á, –æ—á–µ—Ä–µ–¥–µ–π –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π.

---

# üß© –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏ RabbitMQ

1. **Producer** ‚Äî –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è
2. **Exchange** ‚Äî —Ä–µ—à–∞–µ—Ç, –∫—É–¥–∞ –Ω–∞–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ
3. **Queue** ‚Äî —Ö—Ä–∞–Ω–∏—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–æ –ø–æ–ª—É—á–µ–Ω–∏—è Consumer‚Äô–æ–º
4. **Consumer** ‚Äî –∑–∞–±–∏—Ä–∞–µ—Ç –∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ
5. **Binding** ‚Äî –ø—Ä–∞–≤–∏–ª–æ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏ Exchange ‚Üí Queue

---

## üîπ –¢–∏–ø—ã Exchange

| –¢–∏–ø         | –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç         | –ü—Ä–∏–º–µ—Ä                        |
| ----------- | -------------------- | ----------------------------- |
| **direct**  | exact match routing  | `exchange.direct` ‚Üí `queue_A` |
| **fanout**  | –≤—Å–µ –æ—á–µ—Ä–µ–¥–∏ –ø–æ–ª—É—á–∞—é—Ç | –ø—É–±–ª–∏–∫–∞—Ü–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π        |
| **topic**   | —à–∞–±–ª–æ–Ω—ã (`*`, `#`)   | `logs.*` ‚Üí —Ä–∞–∑–Ω—ã–µ –æ—á–µ—Ä–µ–¥–∏     |
| **headers** | –ø–æ –∑–∞–≥–æ–ª–æ–≤–∫–∞–º        | —Ä–µ–¥–∫–∏–π, —Å–ª–æ–∂–Ω—ã–π               |

---

# üõ† –ü—Ä–æ—Å—Ç–µ–π—à–∏–π –ø—Ä–∏–º–µ—Ä (Node.js + amqplib)

```ts
import amqp from 'amqplib';

async function send() {
  const conn = await amqp.connect('amqp://localhost');
  const channel = await conn.createChannel();

  const queue = 'tasks';
  await channel.assertQueue(queue, { durable: true });

  const message = JSON.stringify({ task: 'send_email', to: 'user@mail.com' });
  channel.sendToQueue(queue, Buffer.from(message), { persistent: true });

  console.log('Message sent');
  await channel.close();
  await conn.close();
}

send();
```

---

### Consumer

```ts
async function consume() {
  const conn = await amqp.connect('amqp://localhost');
  const channel = await conn.createChannel();

  const queue = 'tasks';
  await channel.assertQueue(queue, { durable: true });

  channel.consume(queue, (msg) => {
    if (msg) {
      const content = JSON.parse(msg.content.toString());
      console.log('Processing:', content);
      channel.ack(msg); // –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏
    }
  });
}

consume();
```

---

# üîë –í–∞–∂–Ω—ã–µ —Ñ–∏—á–∏ RabbitMQ

1. **Durable Queues & Persistent Messages**

   * –û—á–µ—Ä–µ–¥–∏ –∏ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–µ—Ä–µ–∂–∏–≤–∞—é—Ç –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ –±—Ä–æ–∫–µ—Ä–∞
2. **Acknowledgements**

   * Consumer –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç, —á—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ
3. **Dead Letter Exchange (DLX)**

   * –ù–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è ‚Üí –æ—Ç–¥–µ–ª—å–Ω–∞—è –æ—á–µ—Ä–µ–¥—å
4. **Prefetch / QoS**

   * –õ–∏–º–∏—Ç —Å–æ–æ–±—â–µ–Ω–∏–π, –∫–æ—Ç–æ—Ä—ã–µ Consumer –±–µ—Ä–µ—Ç –∑–∞ —Ä–∞–∑
5. **TTL / Expiry**

   * –°–æ–æ–±—â–µ–Ω–∏—è –∏–ª–∏ –æ—á–µ—Ä–µ–¥–∏ –º–æ–∂–Ω–æ –æ–≥—Ä–∞–Ω–∏—á–∏—Ç—å –≤—Ä–µ–º–µ–Ω–µ–º –∂–∏–∑–Ω–∏
6. **Publisher Confirms**

   * –ì–∞—Ä–∞–Ω—Ç–∏—è –¥–æ—Å—Ç–∞–≤–∫–∏ –æ—Ç Producer –¥–æ –±—Ä–æ–∫–µ—Ä–∞

---

# üîÑ –†–µ–∞–ª—å–Ω—ã–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –∫–µ–π—Å—ã

## 1Ô∏è‚É£ –û—á–µ—Ä–µ–¥—å —Ñ–æ–Ω–æ–≤—ã—Ö –∑–∞–¥–∞—á

* –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–¥–µ–ª–∞–ª –∑–∞–∫–∞–∑ ‚Üí Producer ‚Üí RabbitMQ ‚Üí Worker ‚Üí –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ stock / –æ—Ç–ø—Ä–∞–≤–∫–∞ –ø–∏—Å—å–º–∞
* –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ, –±–µ–∑ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞

---

## 2Ô∏è‚É£ –†–∞—Å—Å—ã–ª–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

* Exchange —Ç–∏–ø–∞ **fanout**
* –ö–∞–∂–¥–∞—è –æ—á–µ—Ä–µ–¥—å ‚Äî –∫–∞–Ω–∞–ª: email, sms, push

---

## 3Ô∏è‚É£ –ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã

* –ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å A ‚Üí —Å–æ–±—ã—Ç–∏–µ ‚Üí Exchange ‚Üí –ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å B/C
* Loose coupling ‚Üí –ª–µ–≥–∫–æ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞—Ç—å

---

# ‚ö†Ô∏è –ß–∞—Å—Ç—ã–µ –æ—à–∏–±–∫–∏ (–Ω–∞ —Å–æ–±–µ—Å–µ –ª—é–±—è—Ç —Å–ø—Ä–∞—à–∏–≤–∞—Ç—å)

1. **–ù–µ—Ç ack** ‚Üí —Å–æ–æ–±—â–µ–Ω–∏—è —Ç–µ—Ä—è—é—Ç—Å—è –ø—Ä–∏ –ø–∞–¥–µ–Ω–∏–∏ consumer
2. **–°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ durable queues + persistent messages** ‚Üí –º–µ–¥–ª–µ–Ω–Ω–∞—è –∑–∞–ø–∏—Å—å
3. **–°–ª–∏—à–∫–æ–º –º–∞–ª–µ–Ω—å–∫–∏–π prefetch** ‚Üí –Ω–∏–∑–∫–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
4. **–ù–µ –∏—Å–ø–æ–ª—å–∑—É–µ—à—å DLX** ‚Üí –ø–æ—Ç–µ—Ä—è–Ω–Ω—ã–µ –∏–ª–∏ –∑–∞—Å—Ç—Ä—è–≤—à–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è
5. **–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ç–∏–ø exchange** ‚Üí —Å–æ–æ–±—â–µ–Ω–∏—è –Ω–µ –ø–æ–ø–∞–¥–∞—é—Ç –≤ –Ω—É–∂–Ω—É—é –æ—á–µ—Ä–µ–¥—å

---

# üé§ –ó–æ–ª–æ—Ç—ã–µ —Ñ—Ä–∞–∑—ã –¥–ª—è —Å–æ–±–µ—Å–∞

> RabbitMQ ‚Äî —ç—Ç–æ –±—Ä–æ–∫–µ—Ä —Å–æ–æ–±—â–µ–Ω–∏–π —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –æ—á–µ—Ä–µ–¥–µ–π, –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–π –∏ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏, –∏–¥–µ–∞–ª—å–Ω–æ –¥–ª—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–æ–≤ –∏ —Ñ–æ–Ω–æ–≤—ã—Ö –∑–∞–¥–∞—á.

> –ö–ª—é—á–µ–≤—ã–µ —Ñ–∏—á–∏, –Ω–∞ –∫–æ—Ç–æ—Ä—ã–µ —è –æ–±—Ä–∞—â–∞—é –≤–Ω–∏–º–∞–Ω–∏–µ: durable queues, ack, DLX, QoS –∏ —Ç–∏–ø exchange.

---

# üß† –ö–æ—Ä–æ—Ç–∫–∞—è —à–ø–∞—Ä–≥–∞–ª–∫–∞

| –ö–æ–Ω—Ü–µ–ø—Ç  | –ß—Ç–æ –¥–µ–ª–∞–µ—Ç                      |
| -------- | ------------------------------- |
| Producer | –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ            |
| Consumer | –∑–∞–±–∏—Ä–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ              |
| Exchange | –º–∞—Ä—à—Ä—É—Ç–∏–∑–∏—Ä—É–µ—Ç                  |
| Queue    | —Ö—Ä–∞–Ω–∏—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ                |
| Binding  | –ø—Ä–∏–≤—è–∑—ã–≤–∞–µ—Ç exchange –∫ queue    |
| Ack      | –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫—É          |
| DLX      | –ª–æ–≤—É—à–∫–∞ –¥–ª—è –Ω–µ—É–¥–∞—á–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π |
| Prefetch | –ª–∏–º–∏—Ç –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π    |
