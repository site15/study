# üß© –û—á–µ—Ä–µ–¥–∏ –∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å –≤ System Design

–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å –∏ –æ—á–µ—Ä–µ–¥–∏ ‚Äî **–∫–ª—é—á–µ–≤–æ–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç–∏** –≤ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º–∞—Ö.

- –í –ø—Ä–æ–¥–µ **–º–Ω–æ–≥–æ–º–∏–ª–ª–∏–æ–Ω–Ω–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞** ‚Üí –Ω–µ–ª—å–∑—è —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –≤—Å—ë
- –û—á–µ—Ä–µ–¥–∏ –ø–æ–∑–≤–æ–ª—è—é—Ç **—Ä–∞–∑–≤—è–∑–∞—Ç—å Producer –∏ Consumer**, —É–ø—Ä–∞–≤–ª—è—Ç—å –Ω–∞–≥—Ä—É–∑–∫–æ–π, retries –∏ failures

---

## 1Ô∏è‚É£ –û—Å–Ω–æ–≤–Ω—ã–µ –ø–æ–Ω—è—Ç–∏—è

| –¢–µ—Ä–º–∏–Ω                  | –û–ø–∏—Å–∞–Ω–∏–µ                                                 |
| ----------------------- | -------------------------------------------------------- |
| Producer                | –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–¥–∞—á—É –∏–ª–∏ —Å–æ–±—ã—Ç–∏–µ –≤ –æ—á–µ—Ä–µ–¥—å                  |
| Consumer                | –ü–æ–ª—É—á–∞–µ—Ç –∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –∏–∑ –æ—á–µ—Ä–µ–¥–∏             |
| Queue                   | –•—Ä–∞–Ω–∏–ª–∏—â–µ —Å–æ–æ–±—â–µ–Ω–∏–π –¥–æ –∏—Ö –æ–±—Ä–∞–±–æ—Ç–∫–∏                      |
| Exchange / Topic        | –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç, –∫—É–¥–∞ –ø–æ–π–¥—É—Ç —Å–æ–æ–±—â–µ–Ω–∏—è (RabbitMQ, Kafka)      |
| Dead Letter Queue (DLQ) | –°–æ–æ–±—â–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ —É–¥–∞–ª–æ—Å—å –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å                 |
| Backpressure            | –ú–µ—Ö–∞–Ω–∏–∑–º –∑–∞–º–µ–¥–ª–µ–Ω–∏—è Producer‚Äô–∞, –µ—Å–ª–∏ –æ—á–µ—Ä–µ–¥—å –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∞ |

---

## 2Ô∏è‚É£ –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å –∏ decoupling

**–ü–æ—á–µ–º—É —ç—Ç–æ –≤–∞–∂–Ω–æ:**

- Producer –Ω–µ –∂–¥—ë—Ç, –ø–æ–∫–∞ Consumer –æ–±—Ä–∞–±–æ—Ç–∞–µ—Ç –∑–∞–¥–∞—á—É ‚Üí Event-driven
- –ü–æ–≤—ã—à–∞–µ—Ç throughput –∏ —Å–Ω–∏–∂–∞–µ—Ç latency –Ω–∞ –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–∞—Ö

**–ü—Ä–∏–º–µ—Ä (NestJS):**

- HTTP-–∑–∞–ø—Ä–æ—Å –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ‚Üí Producer ‚Üí RabbitMQ
- Worker ‚Üí Consumer ‚Üí –æ–±–Ω–æ–≤–ª—è–µ—Ç –±–∞–∑—É –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ

```ts
// Producer
this.client.emit('order_created', orderDto);

// Consumer
@EventPattern('order_created')
async handleOrderCreated(orderDto: OrderDto) {
  await this.inventoryService.reserveStock(orderDto);
  await this.notificationService.sendOrderNotification(orderDto);
}
```

---

## 3Ô∏è‚É£ –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –≤ System Design

### 3.1 Background tasks

- –û—Ç–ø—Ä–∞–≤–∫–∞ email, push, SMS
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è PDF, –æ—Ç—á—ë—Ç–æ–≤
- –í–∏–¥–µ–æ/–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è ‚Üí –æ–±—Ä–∞–±–æ—Ç–∫–∞, –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è

### 3.2 Event-driven –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

- –°–µ—Ä–≤–∏—Å—ã –æ–±–º–µ–Ω–∏–≤–∞—é—Ç—Å—è —Å–æ–±—ã—Ç–∏—è–º–∏ —á–µ—Ä–µ–∑ Kafka / NATS / RabbitMQ
- Saga pattern –¥–ª—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π

### 3.3 Load leveling

- –û—á–µ—Ä–µ–¥–∏ **—Å–≥–ª–∞–∂–∏–≤–∞—é—Ç spikes**
- Consumer –º–æ–∂–µ—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è —Å —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —Å–∫–æ—Ä–æ—Å—Ç—å—é ‚Üí –∑–∞—â–∏—Ç–∞ backend —Å–µ—Ä–≤–∏—Å–æ–≤

---

## 4Ô∏è‚É£ –ù–∞–¥—ë–∂–Ω–æ—Å—Ç—å

**Dead Letter Queue (DLQ):**

- –°–æ–æ–±—â–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ —É–¥–∞–ª–æ—Å—å –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å, –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –≤ –æ—Ç–¥–µ–ª—å–Ω—É—é –æ—á–µ—Ä–µ–¥—å
- –ü–æ–∑–≤–æ–ª—è–µ—Ç –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–±–ª–µ–º—ã –∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å

**Retry + Backoff:**

- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏ –ø—Ä–∏ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Å–±–æ—è—Ö
- Exponential backoff –¥–ª—è —É–º–µ–Ω—å—à–µ–Ω–∏—è –Ω–∞–≥—Ä—É–∑–∫–∏

**–ü—Ä–∏–º–µ—Ä:**

```ts
@EventPattern('payment_failed')
async handlePaymentFailed(@Payload() message) {
  try {
    await this.paymentService.retryPayment(message);
  } catch (e) {
    await this.dlqService.sendToDLQ(message);
  }
}
```

---

## 5Ô∏è‚É£ –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å

- –û—á–µ—Ä–µ–¥–∏ –ø–æ–∑–≤–æ–ª—è—é—Ç **–≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞—Ç—å Consumers**
- Producer –º–æ–∂–µ—Ç –æ—Å—Ç–∞–≤–∞—Ç—å—Å—è stateless ‚Üí –ª–µ–≥–∫–æ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º—ã–π API
- –ò—Å–ø–æ–ª—å–∑—É–µ–º partitioning –≤ Kafka –∏–ª–∏ multiple queues –≤ RabbitMQ –¥–ª—è load balancing

**–ü—Ä–∏–º–µ—Ä:**

```
UserService (Producer) ‚Üí RabbitMQ exchange ‚Üí 3 Consumers (EmailService instances)
```

- –ï—Å–ª–∏ spike —Ç—Ä–∞—Ñ–∏–∫–∞ ‚Üí –æ—á–µ—Ä–µ–¥—å –Ω–∞–∫–∞–ø–ª–∏–≤–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è, Consumers –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç –∏—Ö –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ

---

## 6Ô∏è‚É£ –¢–∏–ø–∏—á–Ω—ã–µ —Å–æ–±–µ—Å–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã

1. –ü–æ—á–µ–º—É –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ—á–µ—Ä–µ–¥–∏ –≤–º–µ—Å—Ç–æ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö HTTP –≤—ã–∑–æ–≤–æ–≤?
2. –ö–∞–∫ –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å spike —Ç—Ä–∞—Ñ–∏–∫–∞?
3. –ö–∞–∫ –æ–±–µ—Å–ø–µ—á–∏—Ç—å **at-least-once delivery**?
4. –ö–æ–≥–¥–∞ –Ω—É–∂–µ–Ω DLQ –∏ –∫–∞–∫ —Å –Ω–∏–º —Ä–∞–±–æ—Ç–∞—Ç—å?
5. –ö–∞–∫ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞—Ç—å Consumers –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ?
6. –ö–∞–∫–∏–µ trade-offs Kafka vs RabbitMQ vs NATS –¥–ª—è –æ—á–µ—Ä–µ–¥–µ–π —Å–æ–æ–±—â–µ–Ω–∏–π?

---

## 7Ô∏è‚É£ –ü—Ä–æ–¥–∞–∫—à–µ–Ω-–ø–∞—Ç—Ç–µ—Ä–Ω—ã

- **Producer/Consumer decoupling** ‚Üí –ø–æ–≤—ã—à–∞–µ—Ç —É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å
- **Retry + DLQ** ‚Üí –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç—å –ø—Ä–∏ —Å–±–æ—è—Ö
- **Backpressure / QoS / Prefetch** ‚Üí –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–≥—Ä—É–∑–∫–∏
- **Event-driven Saga** ‚Üí —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã—Ö –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–æ–≤
- **Partitioned queues** ‚Üí –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏ –≤—ã—Å–æ–∫–∏—Ö TPS

---

## 8Ô∏è‚É£ –ö–æ—Ä–æ—Ç–∫–æ –¥–ª—è —Å–µ–Ω—å–æ—Ä–∞

> –û—á–µ—Ä–µ–¥–∏ + –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å = —Å–ø–æ—Å–æ–± –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞—Ç—å —Å–∏—Å—Ç–µ–º—É, —Ä–∞–∑–≥—Ä—É–∑–∏—Ç—å –∫—Ä–∏—Ç–∏—á–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã, –æ–±–µ—Å–ø–µ—á–∏—Ç—å –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å –∏ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å spikes —Ç—Ä–∞—Ñ–∏–∫–∞.

> –ö–ª—é—á–µ–≤—ã–µ –º–æ–º–µ–Ω—Ç—ã: Producer/Consumer, DLQ, retries, backpressure, event-driven patterns, Saga, horizontal scaling.
