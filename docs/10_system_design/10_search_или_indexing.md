# üß© Search / Indexing –≤ System Design

**–ß—Ç–æ —ç—Ç–æ:**

- Search ‚Äî –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å **–±—ã—Å—Ç—Ä–æ –Ω–∞—Ö–æ–¥–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–æ –∑–∞–ø—Ä–æ—Å—É** (—Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è, –ø–æ–∏—Å–∫ –ø–æ —Ç–µ–∫—Å—Ç—É, –¥–∏–∞–ø–∞–∑–æ–Ω–∞–º, –∞–≥—Ä–µ–≥–∞—Ç–∞–º)
- Indexing ‚Äî —Å–ø–æ—Å–æ–± **—Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ**, —á—Ç–æ–±—ã –ø–æ–∏—Å–∫ –≤—ã–ø–æ–ª–Ω—è–ª—Å—è **—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ**, –¥–∞–∂–µ –ø—Ä–∏ –º–∏–ª–ª–∏–æ–Ω–∞—Ö –∑–∞–ø–∏—Å–µ–π

> –í —Å–∏—Å—Ç–µ–º–Ω–æ–º –¥–∏–∑–∞–π–Ω–µ –∑–∞–¥–∞—á–∞ –ø–æ–∏—Å–∫–∞ –∏ –∏–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏—è ‚Äî **–Ω–µ –ø—Ä–æ—Å—Ç–æ –Ω–∞–ø–∏—Å–∞—Ç—å SELECT**, –∞ —Å–ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å **–º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º—É—é, –≤—ã—Å–æ–∫–æ–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω—É—é —Å–∏—Å—Ç–µ–º—É –ø–æ–∏—Å–∫–∞**.

---

## 1Ô∏è‚É£ –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç           | –†–æ–ª—å                                                                |
| ------------------- | ------------------------------------------------------------------- |
| **Primary Storage** | SQL/NoSQL –±–∞–∑–∞ (Postgres, MongoDB) ‚Üí —Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏—Å—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö       |
| **Search Engine**   | Elasticsearch, OpenSearch, Algolia ‚Üí –±—ã—Å—Ç—Ä—ã–π –ø–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫   |
| **Index**           | –°—Ç—Ä—É–∫—Ç—É—Ä—ã, —É—Å–∫–æ—Ä—è—é—â–∏–µ –ø–æ–∏—Å–∫: B-Tree, inverted index, hash index     |
| **Pipeline / ETL**  | –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤ ‚Üí –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ —á–µ—Ä–µ–∑ Kafka/RabbitMQ/Redis Streams |

---

## 2Ô∏è‚É£ –¢–∏–ø—ã –ø–æ–∏—Å–∫–∞

1. **Exact Match**

   - –ü—Ä–æ—Å—Ç–æ–π –ø–æ–∏—Å–∫ –ø–æ –∫–ª—é—á—É
   - SQL: `WHERE id = 42` ‚Üí O(log n) —Å –∏–Ω–¥–µ–∫—Å–æ–º
   - Redis / HashMap —Ç–æ–∂–µ –±—ã—Å—Ç—Ä—ã–π –ø–æ–∏—Å–∫

2. **Full-Text Search**

   - –ü–æ–∏—Å–∫ –ø–æ —Ç–µ–∫—Å—Ç—É, —Ñ—Ä–∞–∑–∞–º, —á–∞—Å—Ç—è–º —Å–ª–æ–≤
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç **inverted index**
   - Elasticsearch, Postgres `tsvector`, Algolia

3. **Range / Numeric Search**

   - –ü–æ–∏—Å–∫ –ø–æ –¥–∏–∞–ø–∞–∑–æ–Ω—É –¥–∞—Ç, —Ü–µ–Ω, –º–µ—Ç—Ä–∏–∫
   - –ò–Ω–¥–µ–∫—Å—ã B-Tree –∏–ª–∏ GiST –≤ Postgres, Lucene –¥–ª—è –ø–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–∞

4. **Aggregations / Analytics**

   - –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏, –ø–æ–¥—Å—á—ë—Ç—ã, —Ç–æ–ø-N, median
   - Elasticsearch –∏–ª–∏ OLAP –±–∞–∑—ã (ClickHouse)

---

## 3Ô∏è‚É£ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –ø–æ–¥—Ö–æ–¥—ã

### üîπ SQL —Å –∏–Ω–¥–µ–∫—Å–∞–º–∏

- –ü—Ä–æ—Å—Ç–æ–π –∏ –ø–æ–Ω—è—Ç–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç
- Index Types:

  - **B-Tree** ‚Üí —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞, –¥–∏–∞–ø–∞–∑–æ–Ω—ã, equality
  - **GIN / GiST** ‚Üí –º–∞—Å—Å–∏–≤—ã, JSON, –ø–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç

**–ü—Ä–∏–º–µ—Ä Postgres:**

```sql
CREATE INDEX IDX_User_email ON "User"("email");
CREATE INDEX IDX_Post_content ON "Post" USING GIN(to_tsvector('english', "content"));
```

- **–ü–ª—é—Å—ã:** –ª–µ–≥–∫–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å, —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω–æ
- **–ú–∏–Ω—É—Å—ã:** –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–æ –æ–¥–Ω–æ–π –ë–î, —Ç—è–∂–µ–ª—ã–π full-text –ø–æ–∏—Å–∫

---

### üîπ Elasticsearch / OpenSearch

- –•—Ä–∞–Ω–∏—Ç –¥–∞–Ω–Ω—ã–µ –≤ **–¥–æ–∫—É–º–µ–Ω—Ç–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ**, —Å inverted index
- –û—Ç–ª–∏—á–Ω–æ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è:

  - –ü–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –ø–æ–∏—Å–∫–∞
  - –§–∏–ª—å—Ç—Ä–æ–≤ –ø–æ –Ω–µ—Å–∫–æ–ª—å–∫–∏–º –ø–æ–ª—è–º
  - –ê–≥—Ä–µ–≥–∞—Ü–∏–π –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏

**–ü—Ä–æ–¥–∞–∫—à–µ–Ω-–ø–∞—Ç—Ç–µ—Ä–Ω:**

- Main DB ‚Üí Event ‚Üí Kafka/RabbitMQ ‚Üí Indexer ‚Üí Elasticsearch
- –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è ‚Üí eventual consistency

---

### üîπ –ö—ç—à –∏ –±—ã—Å—Ç—Ä—ã–π –ø–æ–∏—Å–∫

- Redis ‚Üí –¥–ª—è frequently accessed queries / autocomplete
- Trie / Sorted Set ‚Üí –±—ã—Å—Ç—Ä—ã–π prefix search

**–ü—Ä–∏–º–µ—Ä:**

```ts
// Redis Sorted Set –¥–ª—è –∞–≤—Ç–æ–∫–æ–º–ø–ª–∏—Ç–∞
ZADD autocomplete:users 0 "danil"
ZADD autocomplete:users 0 "daria"
ZRANGEBYLEX autocomplete:users [da [db
```

---

## 4Ô∏è‚É£ –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ

1. **Sharding / Partitioning**

   - –î–∞–Ω–Ω—ã–µ –¥–µ–ª—è—Ç—Å—è –ø–æ userId / tenantId / docId
   - Elasticsearch shards + replicas

2. **Replication**

   - –î–ª—è –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç–∏ –∏ —á—Ç–µ–Ω–∏—è –±–µ–∑ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫
   - SQL: read replicas
   - ES: primary + replica shards

3. **Bulk Updates**

   - –ò–Ω–¥–µ–∫—Å–∏—Ä—É–µ–º –ø–∞—á–∫–∞–º–∏ ‚Üí –º–µ–Ω—å—à–µ –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ search engine

---

## 5Ô∏è‚É£ –ü—Ä–æ–±–ª–µ–º—ã –∏ trade-offs

| –ü—Ä–æ–±–ª–µ–º–∞                             | –†–µ—à–µ–Ω–∏–µ / Trade-off                                   |
| ------------------------------------ | ----------------------------------------------------- |
| –ò–Ω–¥–µ–∫—Å—ã –∑–∞–Ω–∏–º–∞—é—Ç –ø–∞–º—è—Ç—å              | —Ö—Ä–∞–Ω–∏—Ç—å —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω—ã–µ –ø–æ–ª—è, TTL –¥–ª—è —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö –¥–∞–Ω–Ω—ã—Ö |
| –ü–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫ –º–µ–¥–ª–µ–Ω–Ω—ã–π –≤ SQL | Elasticsearch / GIN / GiST                            |
| –ó–∞–¥–µ—Ä–∂–∫–∞ –ø—Ä–∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏  | eventual consistency, events ‚Üí search pipeline        |
| –ë–æ–ª—å—à–æ–π –ø–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö                 | Bulk insert / partitioning / throttling               |

---

## 6Ô∏è‚É£ –¢–∏–ø–æ–≤–æ–π –≤–æ–ø—Ä–æ—Å –Ω–∞ —Å–æ–±–µ—Å–µ

> ¬´–°–ø—Ä–æ–µ–∫—Ç–∏—Ä—É–π —Å–∏—Å—Ç–µ–º—É –ø–æ–∏—Å–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –≤ —á–∞—Ç–µ –Ω–∞ –º–∏–ª–ª–∏–æ–Ω—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, —Å —Ñ–∏–ª—å—Ç—Ä–æ–º –ø–æ –≤—Ä–µ–º–µ–Ω–∏ –∏ –ø–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤—ã–º –ø–æ–∏—Å–∫–æ–º –ø–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–º—É¬ª

–ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è—é—Ç:

- Indexing strategy ‚Üí –∫–∞–∫ —É—Å–∫–æ—Ä–∏—Ç—å –ø–æ–∏—Å–∫
- Choice of storage ‚Üí SQL vs NoSQL vs Elasticsearch
- Scaling ‚Üí shards, replicas, cache
- Consistency ‚Üí eventual vs strong, update pipeline

---

## 7Ô∏è‚É£ –ò—Ç–æ–≥ –¥–ª—è —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ –¥–∏–∑–∞–π–Ω–∞

- **Search / Indexing** ‚Äî —ç—Ç–æ –∫–ª—é—á–µ–≤–æ–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç, –∫–æ—Ç–æ—Ä—ã–π –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç **latency –∏ user experience**
- –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –≤–∫–ª—é—á–∞–µ—Ç:

  1. –í—ã–±–æ—Ä **storage –∏ index type**
  2. –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤ —á–µ—Ä–µ–∑ **events / queue**
  3. –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –≥–æ—Ä—è—á–∏—Ö –¥–∞–Ω–Ω—ã—Ö (Redis, trie)
  4. –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ **sharding –∏ replication**

- Eventual consistency —á–∞—Å—Ç–æ –¥–æ–ø—É—Å—Ç–∏–º–∞ –¥–ª—è –ø–æ–∏—Å–∫–∞, –Ω–æ –Ω—É–∂–Ω–æ –æ–±—ä—è—Å–Ω–∏—Ç—å trade-offs –Ω–∞ —Å–æ–±–µ—Å–µ
