## **11.2.1. B-ะดะตัะตะฒะพ (B-tree)** โ *ะดะตัะพะปั*

### ะงัะพ ััะพ

ะกะฐะผัะน ัะฝะธะฒะตััะฐะปัะฝัะน ะธะฝะดะตะบั ะฒ PostgreSQL.
ะะพะดะดะตัะถะธะฒะฐะตั:

* `=`
* `< <= > >=`
* `BETWEEN`
* `ORDER BY`
* `IS NULL`

ะัะฟะพะปัะทัะตััั **ะฟะพััะธ ะฒัะตะณะดะฐ**, ะตัะปะธ ะฝะต ะทะฝะฐะตัั ััะพ ะฒัะฑัะฐัั โ ะฒัะฑะธัะฐะน B-tree.

### ะะพะณะดะฐ ะธัะฟะพะปัะทะพะฒะฐัั

* ะฟะพะธัะบ ะฟะพ ัะพัะฝะพะผั ะทะฝะฐัะตะฝะธั
* ะดะธะฐะฟะฐะทะพะฝั
* ัะพััะธัะพะฒะบะธ
* ัะฝะธะบะฐะปัะฝัะต ะพะณัะฐะฝะธัะตะฝะธั

### ะัะธะผะตั

```sql
CREATE INDEX IDX_users__email
ON "Users" USING BTREE ("email");

-- ะัะฟะพะปัะทัะตััั ะฒ ะทะฐะฟัะพัะต
SELECT *
FROM "Users"
WHERE "email" = 'test@mail.com';
```

---

## **11.2.2. Hash** โ *ัะพะปัะบะพ equality*

### ะงัะพ ััะพ

ะฅะตั-ะธะฝะดะตะบั, ัะฐะฑะพัะฐะตั **ัะพะปัะบะพ ั `=`**.
ะะธะฐะฟะฐะทะพะฝั ะธ ัะพััะธัะพะฒะบะธ ะฝะต ะฟะพะดะดะตัะถะธะฒะฐะตั.

ะะฐะฝััะต ะฑัะป ะฝะตะฑะตะทะพะฟะฐัะตะฝ (ะดะพ PG 10), ัะตะนัะฐั ะฝะพัะผ, ะฝะพ **ัะตะดะบะพ ะฝัะถะตะฝ**.

### ะะพะณะดะฐ ะธัะฟะพะปัะทะพะฒะฐัั

* ะพัะตะฝั ัะฐัััะต ะทะฐะฟัะพัั ะฒะธะดะฐ `column = value`
* ะฝะตั ัะพััะธัะพะฒะพะบ ะธ ะดะธะฐะฟะฐะทะพะฝะพะฒ
* ะธะฝะพะณะดะฐ ัััั ะฑััััะตะต B-tree (ะฝะพ ัะตะดะบะพ ะบัะธัะธัะฝะพ)

### ะัะธะผะตั

```sql
CREATE INDEX IDX_sessions__token
ON "Sessions" USING HASH ("token");

SELECT *
FROM "Sessions"
WHERE "token" = 'abc123';
```

๐ ะฝะฐ ัะพะฑะตัะต: *ยซะฒ 99% ัะปััะฐะตะฒ B-tree ะปัััะตยป*

---

## **11.2.3. GiST (Generalized Search Tree)** โ *ะณะตะพะผะตััะธั, ะดะธะฐะฟะฐะทะพะฝั, full-text*

### ะงัะพ ััะพ

ะะฑะพะฑััะฝะฝะพะต ะดะตัะตะฒะพ ะดะปั **ัะปะพะถะฝัั ัะธะฟะพะฒ ะดะฐะฝะฝัั**:

* `range` (`int4range`, `tsrange`)
* ะณะตะพะดะฐะฝะฝัะต (`PostGIS`)
* `LIKE '%text%'` (ัะตัะตะท ัะฐััะธัะตะฝะธั)
* full-text (ะฐะปััะตัะฝะฐัะธะฒะฐ GIN)

### ะะพะณะดะฐ ะธัะฟะพะปัะทะพะฒะฐัั

* ะฟะตัะตัะตัะตะฝะธั ะดะธะฐะฟะฐะทะพะฝะพะฒ
* ะณะตะพะฟะพะธัะบ
* ะฝะตััะฐะฝะดะฐััะฝัะต ะพะฟะตัะฐัะพัั (`&&`, `@>`, `<@`)

### ะัะธะผะตั (range)

```sql
CREATE INDEX IDX_events__period
ON "Events" USING GIST ("period");

SELECT *
FROM "Events"
WHERE "period" && tsrange(now(), now() + interval '1 day');
```

---

## **11.2.4. SP-GiST (Space-Partitioned GiST)** โ *ะดะตัะตะฒัั, ะฟัะตัะธะบัั*

### ะงัะพ ััะพ

ะะฟัะธะผะธะทะธัะพะฒะฐะฝ ะดะปั **ะธะตัะฐััะธัะตัะบะธั ะธ ัะฐะทัะตะถะตะฝะฝัั ะดะฐะฝะฝัั**:

* IP-ะฐะดัะตัะฐ
* ะฟัะตัะธะบัะฝัะน ะฟะพะธัะบ
* quadtrees, k-d trees

### ะะพะณะดะฐ ะธัะฟะพะปัะทะพะฒะฐัั

* `LIKE 'abc%'`
* IP / CIDR
* ััััะบัััั ั ัะฐะทะดะตะปะตะฝะธะตะผ ะฟัะพัััะฐะฝััะฒะฐ

### ะัะธะผะตั (prefix search)

```sql
CREATE INDEX IDX_users__login_prefix
ON "Users" USING SPGIST ("login");

SELECT *
FROM "Users"
WHERE "login" LIKE 'admin%';
```

---

## **11.2.5. GIN (Generalized Inverted Index)** โ *ะผะฐััะธะฒั, JSONB, full-text*

### ะงัะพ ััะพ

ะะฝะดะตะบั **ยซะทะฝะฐัะตะฝะธะต โ ัะฟะธัะพะบ ัััะพะบยป**.
ะะตะดะปะตะฝะฝัะน INSERT/UPDATE, ะฝะพ **ะพัะตะฝั ะฑัััััะน SELECT**.

### ะะพะณะดะฐ ะธัะฟะพะปัะทะพะฒะฐัั

* `jsonb`
* ะผะฐััะธะฒั
* `@>`, `?`, `?|`, `?&`
* full-text search

### ะัะธะผะตั (JSONB)

```sql
CREATE INDEX IDX_orders__meta
ON "Orders" USING GIN ("meta");

SELECT *
FROM "Orders"
WHERE "meta" @> '{"status": "paid"}';
```

### ะัะธะผะตั (array)

```sql
CREATE INDEX IDX_users__roles
ON "Users" USING GIN ("roles");

SELECT *
FROM "Users"
WHERE "roles" @> ARRAY['admin'];
```

---

## **11.2.6. BRIN (Block Range INdex)** โ *ะพัะตะฝั ะฑะพะปััะธะต ัะฐะฑะปะธัั*

### ะงัะพ ััะพ

ะฅัะฐะฝะธั **ะผะธะฝะธะผัะผ/ะผะฐะบัะธะผัะผ ะฟะพ ะดะธะฐะฟะฐะทะพะฝะฐะผ ัััะฐะฝะธั**.
ะัะตะฝั ะผะฐะปะตะฝัะบะธะน, ะพัะตะฝั ะดะตััะฒัะน.

### ะะพะณะดะฐ ะธัะฟะพะปัะทะพะฒะฐัั

* ัะฐะฑะปะธัั ะฝะฐ **ะดะตัััะบะธ/ัะพัะฝะธ ะผะธะปะปะธะพะฝะพะฒ ัััะพะบ**
* ะดะฐะฝะฝัะต ะบะพััะตะปะธัััั ั ัะธะทะธัะตัะบะธะผ ะฟะพััะดะบะพะผ (`createdAt`, `id`)
* append-only

### ะัะธะผะตั

```sql
CREATE INDEX IDX_logs__createdAt
ON "Logs" USING BRIN ("createdAt");

SELECT *
FROM "Logs"
WHERE "createdAt" >= now() - interval '1 day';
```

---

## ๐ก **ะะพัะพัะบะฐั ัะฟะฐัะณะฐะปะบะฐ ะดะปั ัะพะฑะตัะฐ**

| ะขะธะฟ         | ะะพะณะดะฐ ะณะพะฒะพัะธัั                  |
| ----------- | ------------------------------- |
| **B-tree**  | ยซะดะตัะพะปั, 90% ะบะตะนัะพะฒยป            |
| **Hash**    | ยซัะพะปัะบะพ equality, ัะตะดะบะพ ะฝัะถะตะฝยป  |
| **GiST**    | ยซrange, geo, ัะปะพะถะฝัะต ะพะฟะตัะฐัะพััยป |
| **SP-GiST** | ยซprefix, IP, ะธะตัะฐััะธะธยป          |
| **GIN**     | ยซjsonb, array, full-textยป       |
| **BRIN**    | ยซะพะณัะพะผะฝัะต ัะฐะฑะปะธัั, append-onlyยป |