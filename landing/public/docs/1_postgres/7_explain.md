# üîç EXPLAIN –∏ EXPLAIN ANALYZE ‚Äî –∫–∞–∫ —á–∏—Ç–∞—Ç—å –ø–ª–∞–Ω—ã –∑–∞–ø—Ä–æ—Å–æ–≤

## –ó–∞—á–µ–º —ç—Ç–æ –≤–æ–æ–±—â–µ –Ω—É–∂–Ω–æ

`EXPLAIN` –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç **–ö–ê–ö PostgreSQL —Å–æ–±–∏—Ä–∞–µ—Ç—Å—è –≤—ã–ø–æ–ª–Ω–∏—Ç—å –∑–∞–ø—Ä–æ—Å**,
–∞ `EXPLAIN ANALYZE` ‚Äî **–∫–∞–∫ –æ–Ω —Ä–µ–∞–ª—å–Ω–æ –µ–≥–æ –≤—ã–ø–æ–ª–Ω–∏–ª**.

> –ò–Ω–¥–µ–∫—Å—ã, join‚Äô—ã, —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏, –æ—à–∏–±–∫–∏ –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è ‚Äî –≤—Å—ë –≤–∏–¥–Ω–æ –∑–¥–µ—Å—å.

---

# 1Ô∏è‚É£ EXPLAIN

```sql
EXPLAIN
SELECT *
FROM "Orders"
WHERE "tenantId" = '...'
  AND "status" = 'paid';
```

### –ß—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç

* **–ø–ª–∞–Ω –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è**
* **–æ—Ü–µ–Ω–∫—É** —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Å—Ç—Ä–æ–∫
* **–±–µ–∑ —Ä–µ–∞–ª—å–Ω–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞**

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è:

* –ø–æ–Ω–∏–º–∞–Ω–∏—è —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏
* –ø—Ä–æ–≤–µ—Ä–∫–∏, –∫–∞–∫–æ–π –∏–Ω–¥–µ–∫—Å **–ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ —Ö–æ—á–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å**

---

## –ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞ (—É–ø—Ä–æ—â—ë–Ω–Ω–æ)

```
Index Scan using IDX_orders__tenantId_status on Orders
  Cost: 0.42..12.35
  Rows: 10
```

### –ö–∞–∫ —ç—Ç–æ —á–∏—Ç–∞—Ç—å

* `Index Scan` ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ–º –∏–Ω–¥–µ–∫—Å
* `IDX_orders__tenantId_status` ‚Äî –∫–∞–∫–æ–π –∏–º–µ–Ω–Ω–æ
* `Cost` ‚Äî **–æ—Ü–µ–Ω–∫–∞**, –Ω–µ –≤—Ä–µ–º—è
* `Rows` ‚Äî –æ–∂–∏–¥–∞–µ–º–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–æ–∫

---

# 2Ô∏è‚É£ EXPLAIN ANALYZE

```sql
EXPLAIN ANALYZE
SELECT *
FROM "Orders"
WHERE "tenantId" = '...'
  AND "status" = 'paid';
```

### –ß—Ç–æ –¥–µ–ª–∞–µ—Ç

* **–≤—ã–ø–æ–ª–Ω—è–µ—Ç –∑–∞–ø—Ä–æ—Å**
* –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç **—Ä–µ–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è**
* —Å—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç –æ–∂–∏–¥–∞–Ω–∏—è —Å —Ä–µ–∞–ª—å–Ω–æ—Å—Ç—å—é

---

## –ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞

```
Index Scan using IDX_orders__tenantId_status on Orders
  (cost=0.42..12.35 rows=10 width=200)
  (actual time=0.05..0.07 rows=12 loops=1)
```

### –ì–ª–∞–≤–Ω–æ–µ –æ—Ç–ª–∏—á–∏–µ

* `cost / rows` ‚Äî –ø—Ä–æ–≥–Ω–æ–∑
* `actual time / rows` ‚Äî —Ñ–∞–∫—Ç—ã

üëâ –µ—Å–ª–∏ —Å–∏–ª—å–Ω–æ —Ä–∞—Å—Ö–æ–¥—è—Ç—Å—è ‚Äî **–ø–ª–æ—Ö–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏–ª–∏ –ø–ª–æ—Ö–æ–π –∏–Ω–¥–µ–∫—Å**

---

# üß† –û—Å–Ω–æ–≤–Ω—ã–µ —É–∑–ª—ã –ø–ª–∞–Ω–∞ (must know)

## üîπ Seq Scan

```text
Seq Scan on Orders
```

* –ø–æ–ª–Ω—ã–π –æ–±—Ö–æ–¥ —Ç–∞–±–ª–∏—Ü—ã
* **–Ω–µ –≤—Å–µ–≥–¥–∞ –ø–ª–æ—Ö–æ**
* —á–∞—Å—Ç–æ –±—ã—Å—Ç—Ä–µ–µ –¥–ª—è –º–∞–ª–µ–Ω—å–∫–∏—Ö —Ç–∞–±–ª–∏—Ü

---

## üîπ Index Scan

```text
Index Scan using IDX_...
```

* —Ç–æ—á–µ—á–Ω—ã–π –¥–æ—Å—Ç—É–ø –ø–æ –∏–Ω–¥–µ–∫—Å—É
* —Ö–æ—Ä–æ—à–æ –ø—Ä–∏ –≤—ã—Å–æ–∫–æ–π —Å–µ–ª–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏

---

## üîπ Index Only Scan

```text
Index Only Scan
```

* —Ç–∞–±–ª–∏—Ü–∞ **–Ω–µ —á–∏—Ç–∞–µ—Ç—Å—è**
* –≤—Å—ë –µ—Å—Ç—å –≤ –∏–Ω–¥–µ–∫—Å–µ
* –∑–∞–≤–∏—Å–∏—Ç –æ—Ç visibility map

---

## üîπ Bitmap Index Scan + Bitmap Heap Scan

```text
Bitmap Index Scan
Bitmap Heap Scan
```

* –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **–Ω–µ—Å–∫–æ–ª—å–∫–æ –∏–Ω–¥–µ–∫—Å–æ–≤**
* —Ö–æ—Ä–æ—à–æ –¥–ª—è —Å—Ä–µ–¥–Ω–∏—Ö –≤—ã–±–æ—Ä–æ–∫

---

## üîπ Sort

```text
Sort  (cost=...)
```

* —è–≤–Ω–∞—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞
* –µ—Å–ª–∏ –≤–∏–¥–∏—à—å `Sort` ‚Üí **–Ω–µ—Ç –ø–æ–¥—Ö–æ–¥—è—â–µ–≥–æ –∏–Ω–¥–µ–∫—Å–∞**

---

# üìä JOIN –≤ EXPLAIN

## Nested Loop

* –º–∞–ª–µ–Ω—å–∫–∏–µ –≤—ã–±–æ—Ä–∫–∏
* —á–∞—Å—Ç–æ + –∏–Ω–¥–µ–∫—Å
* –ø–ª–æ—Ö–æ –ø—Ä–∏ –±–æ–ª—å—à–∏—Ö –æ–±—ä—ë–º–∞—Ö

## Hash Join

* –±–æ–ª—å—à–∏–µ —Ç–∞–±–ª–∏—Ü—ã
* –Ω–µ—Ç –ø–æ–¥—Ö–æ–¥—è—â–µ–≥–æ –∏–Ω–¥–µ–∫—Å–∞

## Merge Join

* –æ–±–µ —Å—Ç–æ—Ä–æ–Ω—ã –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã
* –∏–¥–µ–∞–ª—å–Ω–æ –ø—Ä–∏ B-tree –∏–Ω–¥–µ–∫—Å–∞—Ö

---

# ‚ö†Ô∏è –ö—Ä–∞—Å–Ω—ã–µ —Ñ–ª–∞–≥–∏ –≤ EXPLAIN

### üö© Seq Scan –Ω–∞ –±–æ–ª—å—à–æ–π —Ç–∞–±–ª–∏—Ü–µ

‚Üí –≤–æ–∑–º–æ–∂–Ω–æ –Ω–µ—Ç –∏–Ω–¥–µ–∫—Å–∞ –∏–ª–∏ –æ–Ω –Ω–µ –ø–æ–¥—Ö–æ–¥–∏—Ç

### üö© `Rows=10`, –∞ `actual rows=100000`

‚Üí –ø–ª–æ—Ö–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ (`ANALYZE`)

### üö© `Sort` + `Limit`

‚Üí –∏–Ω–¥–µ–∫—Å –ø–æ–¥ `ORDER BY` –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç

### üö© `Filter:` –ø–æ—Å–ª–µ Index Scan

‚Üí –∏–Ω–¥–µ–∫—Å –Ω–µ –ø–æ–∫—Ä—ã–≤–∞–µ—Ç –≤—Å–µ —É—Å–ª–æ–≤–∏—è

---

# üõ† –ü–æ–ª–µ–∑–Ω—ã–µ —Ä–µ–∂–∏–º—ã EXPLAIN

```sql
EXPLAIN (ANALYZE, BUFFERS)
```

–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç:

* —á—Ç–µ–Ω–∏–µ —Å –¥–∏—Å–∫–∞ vs –∫—ç—à–∞
* —Ä–µ–∞–ª—å–Ω—É—é I/O –Ω–∞–≥—Ä—É–∑–∫—É

```sql
EXPLAIN (ANALYZE, VERBOSE)
```

* –≤—Å–µ –ø–æ–ª—è
* —Ä–µ–∞–ª—å–Ω—ã–µ –∏–º–µ–Ω–∞ –∫–æ–ª–æ–Ω–æ–∫

---

# üé§ –ó–æ–ª–æ—Ç—ã–µ —Ñ—Ä–∞–∑—ã –¥–ª—è —Å–æ–±–µ—Å–∞

> –Ø –≤—Å–µ–≥–¥–∞ —Å—Ä–∞–≤–Ω–∏–≤–∞—é estimated rows –∏ actual rows ‚Äî —ç—Ç–æ —Å—Ä–∞–∑—É –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º—ã —Å–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π –∏–ª–∏ –∏–Ω–¥–µ–∫—Å–∞–º–∏.

> Seq Scan ‚Äî —ç—Ç–æ –Ω–µ –æ—à–∏–±–∫–∞, –∞ –æ—Å–æ–∑–Ω–∞–Ω–Ω—ã–π –≤—ã–±–æ—Ä –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞.

---

# üß™ –ú–∏–Ω–∏-–∞–ª–≥–æ—Ä–∏—Ç–º –æ—Ç —Å–µ–Ω—å–æ—Ä–∞

1. `EXPLAIN ANALYZE`
2. –ù–∞–π—Ç–∏ —Å–∞–º—ã–π –¥–æ—Ä–æ–≥–æ–π —É–∑–µ–ª
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å `rows vs actual rows`
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å `Sort / Seq Scan`
5. –†–µ—à–∏—Ç—å: –∏–Ω–¥–µ–∫—Å, –ø–µ—Ä–µ–ø–∏—Å–∞—Ç—å –∑–∞–ø—Ä–æ—Å –∏–ª–∏ –æ—Å—Ç–∞–≤–∏—Ç—å –∫–∞–∫ –µ—Å—Ç—å

---

# üéØ –ö–æ—Ä–æ—Ç–∫–∞—è —à–ø–∞—Ä–≥–∞–ª–∫–∞

| –í–∏–¥–∏—à—å        | –î—É–º–∞–µ—à—å                      |
| ------------- | ---------------------------- |
| Seq Scan      | –Ω–æ—Ä–º –∏–ª–∏ –Ω–µ—Ç? —Ä–∞–∑–º–µ—Ä —Ç–∞–±–ª–∏—Ü—ã |
| Sort          | –Ω—É–∂–µ–Ω –∏–Ω–¥–µ–∫—Å                 |
| Bitmap Scan   | –Ω–µ—Å–∫–æ–ª—å–∫–æ —É—Å–ª–æ–≤–∏–π            |
| Rows ‚â† Actual | ANALYZE                      |
| Index Only    | üëç –∏–¥–µ–∞–ª—å–Ω–æ                  |
