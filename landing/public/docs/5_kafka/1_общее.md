# üß† –ß—Ç–æ —Ç–∞–∫–æ–µ Apache Kafka

**Kafka** ‚Äî —ç—Ç–æ **—Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –ø–æ—Ç–æ–∫–æ–≤–æ–π –ø–µ—Ä–µ–¥–∞—á–∏ –¥–∞–Ω–Ω—ã—Ö**:

* –ë—Ä–æ–∫–µ—Ä —Å–æ–æ–±—â–µ–Ω–∏–π + **—Ö—Ä–∞–Ω–∏–ª–∏—â–µ —Å–æ–±—ã—Ç–∏–π** (event log)
* –í—ã—Å–æ–∫–∞—è –ø—Ä–æ–ø—É—Å–∫–Ω–∞—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å (–º–∏–ª–ª–∏–æ–Ω—ã —Å–æ–æ–±—â–µ–Ω–∏–π –≤ —Å–µ–∫—É–Ω–¥—É)
* –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ
* –ù–∞–¥—ë–∂–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—è

> –û—Ç–ª–∏—á–∏–µ –æ—Ç RabbitMQ: Kafka **—Ö—Ä–∞–Ω–∏—Ç —Å–æ–±—ã—Ç–∏—è –¥–æ–ª—å—à–µ**, –æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∞ –Ω–∞ **streaming / pub-sub / –æ–±—Ä–∞–±–æ—Ç–∫—É –±–æ–ª—å—à–∏—Ö –ø–æ—Ç–æ–∫–æ–≤**, –∞ –Ω–µ —Ç–æ–ª—å–∫–æ –Ω–∞ –æ—á–µ—Ä–µ–¥–∏ –∑–∞–¥–∞—á.

---

# üß© –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏ Kafka

| –ö–æ–Ω—Ü–µ–ø—Ç            | –ß—Ç–æ –¥–µ–ª–∞–µ—Ç                                                                             |
| ------------------ | -------------------------------------------------------------------------------------- |
| **Producer**       | –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –≤ —Ç–æ–ø–∏–∫                                                           |
| **Consumer**       | —á–∏—Ç–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –∏–∑ —Ç–æ–ø–∏–∫–∞                                                             |
| **Topic**          | –ª–æ–≥–∏—á–µ—Å–∫–∞—è –æ—á–µ—Ä–µ–¥—å, –º–æ–∂–µ—Ç –∏–º–µ—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø–∞—Ä—Ç–∏—Ü–∏–π                                     |
| **Partition**      | —Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π –≤ –ø–æ—Ä—è–¥–∫–µ –ø–æ—Å—Ç—É–ø–ª–µ–Ω–∏—è; –∫–∞–∂–¥–∞—è –ø–∞—Ä—Ç–∏—Ü–∏—è ‚Äî –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–æ–±—ã—Ç–∏–π |
| **Offset**         | –ø–æ—Ä—è–¥–∫–æ–≤—ã–π –Ω–æ–º–µ—Ä —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –ø–∞—Ä—Ç–∏—Ü–∏–∏                                                  |
| **Broker**         | —Å–µ—Ä–≤–µ—Ä Kafka                                                                           |
| **Consumer Group** | –≥—Ä—É–ø–ø–∞ consumers ‚Üí —Å–æ–æ–±—â–µ–Ω–∏—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è –ø–æ –Ω–∏–º                                     |
| **Replication**    | —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—è –ø–∞—Ä—Ç–∏—Ü–∏–π –¥–ª—è –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç–∏                                             |

---

# üîπ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –∫–ª—é—á–∏

1. **Durability**

   * —Å–æ–æ–±—â–µ–Ω–∏—è –ø–∏—à—É—Ç—Å—è –Ω–∞ –¥–∏—Å–∫, —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –ø–æ —Ä–µ–ø–ª–∏–∫–∞–º
2. **Partitioning**

   * –ø–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º ‚Üí –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ —á—Ç–µ–Ω–∏—è –∏ –∑–∞–ø–∏—Å–∏
3. **Consumer Groups**

   * —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è—é—Ç –Ω–∞–≥—Ä—É–∑–∫—É –º–µ–∂–¥—É consumers
4. **Exactly-once semantics (EOS)**

   * –ø—Ä–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Kafka –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç **–Ω–µ –ø–æ—Ç–µ—Ä—è—Ç—å –∏ –Ω–µ –¥—É–±–ª–∏—Ä–æ–≤–∞—Ç—å —Å–æ–±—ã—Ç–∏—è**

---

# üõ† –ü—Ä–∏–º–µ—Ä –Ω–∞ Node.js (`kafkajs`)

### Producer

```ts
import { Kafka } from 'kafkajs';

const kafka = new Kafka({ clientId: 'app', brokers: ['localhost:9092'] });
const producer = kafka.producer();

await producer.connect();
await producer.send({
  topic: 'orders',
  messages: [
    { key: 'order-1', value: JSON.stringify({ userId: 42, total: 100 }) }
  ]
});
await producer.disconnect();
```

---

### Consumer

```ts
const consumer = kafka.consumer({ groupId: 'orders-group' });

await consumer.connect();
await consumer.subscribe({ topic: 'orders', fromBeginning: true });

await consumer.run({
  eachMessage: async ({ topic, partition, message }) => {
    const order = JSON.parse(message.value!.toString());
    console.log(`Processing order ${message.key}:`, order);
  }
});
```

---

# üîπ –û—Ç–ª–∏—á–∏—è Kafka vs RabbitMQ

| –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞    | Kafka                             | RabbitMQ                 |
| ----------------- | --------------------------------- | ------------------------ |
| –ú–æ–¥–µ–ª—å            | log-based                         | queue-based              |
| –•—Ä–∞–Ω–µ–Ω–∏–µ          | –¥–æ–ª–≥–æ, –ø–æ offset                  | –ø–æ–∫–∞ –Ω–µ ack              |
| –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ   | –ø–∞—Ä—Ç–∏—Ü–∏–∏                          | –æ—á–µ—Ä–µ–¥–∏ + –≤–æ—Ä–∫–µ—Ä—ã        |
| –ì–∞—Ä–∞–Ω—Ç–∏—è –¥–æ—Å—Ç–∞–≤–∫–∏ | at-most / at-least / exactly-once | at-least-once            |
| Use-case          | event streaming, analytics        | background jobs, pub-sub |

---

# üîπ –†–µ–∞–ª—å–Ω—ã–µ –∫–µ–π—Å—ã Kafka

1. **Event sourcing**

   * –í—Å—è –∏—Å—Ç–æ—Ä–∏—è —Å–æ–±—ã—Ç–∏–π ‚Üí —Ä–µ–ø–ª–µ–π ‚Üí –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è
2. **–õ–æ–≥–∏ / –º–µ—Ç—Ä–∏–∫–∏**

   * –º–∏–ª–ª–∏–æ–Ω—ã —Å–æ–±—ã—Ç–∏–π –≤ —Å–µ–∫—É–Ω–¥—É, –ø–æ—Ç–æ–º –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∞–Ω–∞–ª–∏—Ç–∏–∫–æ–π
3. **–§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏**

   * transactional producer ‚Üí exactly-once semantics
4. **–ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã**

   * async –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ ‚Üí loose coupling
5. **Data pipeline**

   * ETL ‚Üí Kafka ‚Üí ClickHouse / Postgres / S3

---

# ‚ö†Ô∏è –ß–∞—Å—Ç—ã–µ –æ—à–∏–±–∫–∏ / –ª–æ–≤—É—à–∫–∏

1. **Consumer —á–∏—Ç–∞–µ—Ç —Å–ª–∏—à–∫–æ–º –º–µ–¥–ª–µ–Ω–Ω–æ** ‚Üí lag —Ä–∞—Å—Ç–µ—Ç
2. **Producer –Ω–µ –∑–∞–¥–∞—ë—Ç key** ‚Üí –≤—Å–µ —Å–æ–±—ã—Ç–∏—è –≤ –æ–¥–Ω—É –ø–∞—Ä—Ç–∏—Ü–∏—é ‚Üí –Ω–µ—Ç –ø–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º–∞
3. **–ù–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—è** ‚Üí –ø–æ—Ç–µ—Ä—è –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –ø–∞–¥–µ–Ω–∏–∏ –±—Ä–æ–∫–µ—Ä–∞
4. **–¢–æ–ø–∏–∫–∏ –±–µ–∑ retention** ‚Üí —Å—Ç–∞—Ä—ã–µ —Å–æ–±—ã—Ç–∏—è —É–¥–∞–ª—è—é—Ç—Å—è —Ä–∞–Ω—å—à–µ –≤—Ä–µ–º–µ–Ω–∏
5. **–î–æ–ª–≥–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤ eachMessage** ‚Üí backpressure ‚Üí lag

---

# üîë –ö–ª—é—á–µ–≤—ã–µ –∫–æ–Ω—Ü–µ–ø—Ç—ã –¥–ª—è —Å–æ–±–µ—Å–∞

* Kafka **log-based**, –∞ –Ω–µ queue-based
* **Offset** = —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –Ω–æ–º–µ—Ä —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –ø–∞—Ä—Ç–∏—Ü–∏–∏
* **Consumer group** ‚Üí —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏
* **Exactly-once semantics** –≤–æ–∑–º–æ–∂–Ω–∞ –ø—Ä–∏ transactional producer/consumer
* –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ **partition + replication**

---

# üé§ –ó–æ–ª–æ—Ç—ã–µ —Ñ—Ä–∞–∑—ã –Ω–∞ —Å–æ–±–µ—Å–µ

> Kafka ‚Äî —ç—Ç–æ **—Ö—Ä–∞–Ω–∏–ª–∏—â–µ —Å–æ–±—ã—Ç–∏–π + –±—Ä–æ–∫–µ—Ä**.
> Producer –ø–∏—à–µ—Ç –≤ —Ç–æ–ø–∏–∫ ‚Üí Consumer —á–∏—Ç–∞–µ—Ç —Å –æ—Ñ—Ñ—Å–µ—Ç–∞ ‚Üí –º–æ–∂–Ω–æ —Ä–µ–ø–ª–µ–∏—Ç—å —Å–æ–±—ã—Ç–∏—è, —Å—Ç—Ä–æ–∏—Ç—å stream processing –∏ –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø–∞–π–ø–ª–∞–π–Ω—ã.

> –û—Å–Ω–æ–≤–Ω–æ–µ –æ—Ç–ª–∏—á–∏–µ –æ—Ç RabbitMQ ‚Äî Kafka —Ö—Ä–∞–Ω–∏—Ç —Å–æ–±—ã—Ç–∏—è –¥–æ–ª–≥–æ, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ –ø–∞—Ä—Ç–∏—Ü–∏–∏ –∏ –∏–¥–µ–∞–ª—å–Ω–æ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º—ã—Ö streaming-—Å–∏—Å—Ç–µ–º.