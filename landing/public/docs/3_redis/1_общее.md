# üöÄ Redis –≤ —Ä–µ–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–∞—Ö

**2 –æ—Å–Ω–æ–≤–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏—è:**

1. **–ö—ç—à** (90% –∫–µ–π—Å–æ–≤)
2. **–û—á–µ—Ä–µ–¥—å / —Ñ–æ–Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏** (10%, –Ω–æ –æ—á–µ–Ω—å –≤–∞–∂–Ω—ã–µ)

---

# üß† Redis –∫–∞–∫ –ö–≠–®

## –ó–∞—á–µ–º Redis, –µ—Å–ª–∏ –µ—Å—Ç—å PostgreSQL?

–ü–æ—Ç–æ–º—É —á—Ç–æ:

* in-memory
* O(1)
* TTL
* —Å–Ω–∏–º–∞–µ—Ç –Ω–∞–≥—Ä—É–∑–∫—É —Å –ë–î

---

## üß© –ë–∞–∑–æ–≤—ã–π –ø–∞—Ç—Ç–µ—Ä–Ω: Cache Aside (Lazy cache)

### –ê–ª–≥–æ—Ä–∏—Ç–º

1. –°–Ω–∞—á–∞–ª–∞ –∏–¥—ë–º –≤ Redis
2. –ï—Å–ª–∏ –Ω–µ—Ç ‚Üí –∏–¥—ë–º –≤ –ë–î
3. –ö–ª–∞–¥—ë–º –≤ Redis —Å TTL

### –ü—Ä–∏–º–µ—Ä (–ø—Å–µ–≤–¥–æ–∫–æ–¥)

```ts
const key = `user:${userId}`;

let user = await redis.get(key);
if (!user) {
  user = await db.users.findById(userId);
  await redis.set(key, JSON.stringify(user), 'EX', 60);
}
return user;
```

---

## ‚è± TTL ‚Äî –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ

```redis
SET user:42 "{...}" EX 60
```

‚ùó –ö—ç—à –±–µ–∑ TTL = –±–æ–º–±–∞ –∑–∞–º–µ–¥–ª–µ–Ω–Ω–æ–≥–æ –¥–µ–π—Å—Ç–≤–∏—è

---

## ‚ö†Ô∏è Cache Invalidation (—Å–∞–º–æ–µ —Å–ª–æ–∂–Ω–æ–µ)

### –ö–ª–∞—Å—Å–∏–∫–∞

```text
UPDATE users SET name = ...
DEL user:42
```

üëâ **–Ω–µ –æ–±–Ω–æ–≤–ª—è–µ–º**, –∞ **—É–¥–∞–ª—è–µ–º**

---

## üß† –ß—Ç–æ –∫—ç—à–∏—Ä–æ–≤–∞—Ç—å

‚úî —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∏
‚úî –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
‚úî –ø—Ä–æ—Ñ–∏–ª–∏
‚úî —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç—è–∂—ë–ª—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

‚ùå –¥–µ–Ω—å–≥–∏
‚ùå –æ—Å—Ç–∞—Ç–∫–∏
‚ùå –∫—Ä–∏—Ç–∏—á–Ω—ã–µ –±–∏–∑–Ω–µ—Å-–∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç—ã

---

# üî• –ê–Ω—Ç–∏–ø–∞—Ç—Ç–µ—Ä–Ω—ã –∫—ç—à–∞

### ‚ùå –ö—ç—à –≤–º–µ—Å—Ç–æ –ë–î

Redis ‚Äî –Ω–µ –∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã

---

### ‚ùå –û–¥–∏–Ω –∫–ª—é—á ‚Äî –æ–¥–∏–Ω –æ–±—ä–µ–∫—Ç –Ω–∞ –≤—Å—ë

```text
users:all
```

‚Üí invalidate = –∞–¥

---

### ‚ùå –ù–µ—Ç namespace

```text
42
```

‚Üí collision

---

# üì¨ Redis –∫–∞–∫ –û–ß–ï–†–ï–î–¨

## –°–∞–º—ã–π –ø—Ä–æ—Å—Ç–æ–π –≤–∞—Ä–∏–∞–Ω—Ç ‚Äî LIST

### Producer

```redis
LPUSH jobs_queue job_id
```

### Consumer

```redis
BRPOP jobs_queue 0
```

‚úî –±–ª–æ–∫–∏—Ä—É—é—â–∏–π
‚úî –ø—Ä–æ—Å—Ç–æ–π
‚ùå –Ω–µ—Ç ack
‚ùå –µ—Å–ª–∏ consumer —É–ø–∞–ª ‚Äî –∑–∞–¥–∞—á–∞ –ø–æ—Ç–µ—Ä—è–Ω–∞

---

## üß† –ü—Ä–æ–¥–∞–∫—à–Ω-–≤–∞—Ä–∏–∞–Ω—Ç ‚Äî Streams (Redis ‚â•5)

### –î–æ–±–∞–≤–∏—Ç—å –∑–∞–¥–∞—á—É

```redis
XADD jobs * type send_email userId 42
```

### –ü—Ä–æ—á–∏—Ç–∞—Ç—å

```redis
XREADGROUP GROUP workers w1 BLOCK 0 STREAMS jobs >
```

### –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å

```redis
XACK jobs workers messageId
```

‚úî ack
‚úî consumer groups
‚úî retry
‚úî –ø–æ—á—Ç–∏ –∫–∞–∫ Kafka light

---

## üß™ –ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π –∫–µ–π—Å: —Ñ–æ–Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏

* –æ—Ç–ø—Ä–∞–≤–∫–∞ email
* –≥–µ–Ω–µ—Ä–∞—Ü–∏—è PDF
* webhooks
* –Ω–æ—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

---

# ‚ö†Ô∏è –û—á–µ—Ä–µ–¥–∏ ‚Äî –≥—Ä–∞–±–ª–∏

### ‚ùå Redis ‚â† Kafka

* –Ω–µ—Ç –≥–∞—Ä–∞–Ω—Ç–∏–∏ exactly-once
* –Ω–µ –¥–ª—è long-term —Ö—Ä–∞–Ω–µ–Ω–∏—è

---

### ‚ùå –ù–µ—Ç retry

–ó–∞–¥–∞—á–∏ –ø—Ä–æ—Å—Ç–æ –ø—Ä–æ–ø–∞–¥–∞—é—Ç

---

# üß† Redis + PostgreSQL –≤–º–µ—Å—Ç–µ (–∏–¥–µ–∞–ª—å–Ω–∞—è —Å–≤—è–∑–∫–∞)

| –ó–∞–¥–∞—á–∞        | –ì–¥–µ           |
| ------------- | ------------- |
| –±–∏–∑–Ω–µ—Å-–¥–∞–Ω–Ω—ã–µ | PostgreSQL    |
| –∫—ç—à           | Redis         |
| –æ—á–µ—Ä–µ–¥—å       | Redis Streams |
| —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏    | PostgreSQL    |

---

# üîê –ù–∞–¥—ë–∂–Ω–æ—Å—Ç—å Redis

### –ß—Ç–æ –≤–∞–∂–Ω–æ –≤–∫–ª—é—á–∏—Ç—å

* persistence (AOF)
* replication
* maxmemory + eviction policy

```redis
maxmemory-policy allkeys-lru
```

---

# üé§ –ó–æ–ª–æ—Ç—ã–µ —Ñ—Ä–∞–∑—ã –¥–ª—è —Å–æ–±–µ—Å–∞

> Redis ‚Äî —ç—Ç–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è, –∞ –Ω–µ –∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã.

> –ö—ç—à ‚Äî —ç—Ç–æ —É—Å–∫–æ—Ä–∏—Ç–µ–ª—å, –∞ –Ω–µ –≥–∞—Ä–∞–Ω—Ç –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏.

> –î–ª—è –æ—á–µ—Ä–µ–¥–µ–π –≤ Redis —è –ø—Ä–µ–¥–ø–æ—á–∏—Ç–∞—é Streams, –∞ –Ω–µ Lists.

---

# üß† –ö–æ—Ä–æ—Ç–∫–∞—è —à–ø–∞—Ä–≥–∞–ª–∫–∞

| –ù—É–∂–Ω–æ            | –†–µ—à–µ–Ω–∏–µ      |
| ---------------- | ------------ |
| –±—ã—Å—Ç—Ä—ã–π read     | Redis        |
| –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ | Redis + TTL  |
| –æ—á–µ—Ä–µ–¥—å          | Streams      |
| cache stampede   | mutex / lock |
| invalidate       | DEL          |
