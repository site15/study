# ๐งฉ Load Balancing & Scaling โ System Design

---

## 1๏ธโฃ **ะงัะพ ััะพ ะธ ะทะฐัะตะผ**

### **Load Balancing (LB)**

- **ะะฐะปะฐะฝัะธัะพะฒะบะฐ ะฝะฐะณััะทะบะธ** ะผะตะถะดั ะฝะตัะบะพะปัะบะธะผะธ ัะตัะฒะตัะฐะผะธ ะธะปะธ ัะตัะฒะธัะฐะผะธ
- ะฆะตะปั: ัะฐะฒะฝะพะผะตัะฝะพ ัะฐัะฟัะตะดะตะปะธัั ััะฐัะธะบ, ะฟัะตะดะพัะฒัะฐัะธัั ะฟะตัะตะณััะทะบั ะพะดะฝะพะณะพ ัะตัะฒะตัะฐ, ะฟะพะฒััะธัั ะดะพัััะฟะฝะพััั

**ะัะธะผะตัั LB ะฝะฐ ะฟัะฐะบัะธะบะต:**

- Nginx / HAProxy โ HTTP load balancer
- AWS ELB / ALB โ managed LB
- L4/L7 ะฑะฐะปะฐะฝัะธัะพะฒะบะฐ: TCP vs HTTP/HTTPS

---

### **Scaling (ะะฐัััะฐะฑะธัะพะฒะฐะฝะธะต)**

- **ะฃะฒะตะปะธัะตะฝะธะต ัะตััััะพะฒ ัะธััะตะผั ะดะปั ะพะฑัะฐะฑะพัะบะธ ะฝะฐะณััะทะบะธ**
- ะะฒะฐ ะฟะพะดัะพะดะฐ:

  1. **Vertical Scaling (Scale Up)** โ ะฑะพะปััะต CPU, RAM ะฝะฐ ะพะดะฝะพะผ ัะตัะฒะตัะต
  2. **Horizontal Scaling (Scale Out)** โ ะดะพะฑะฐะฒะปะตะฝะธะต ะฝะพะฒัั ัะตัะฒะตัะพะฒ/ัะบะทะตะผะฟะปััะพะฒ

**ะัะพะดะฐะบัะตะฝ-ะฟะพะดัะพะด:**

- Node.js โ ะณะพัะธะทะพะฝัะฐะปัะฝะพะต ะผะฐัััะฐะฑะธัะพะฒะฐะฝะธะต ัะตัะตะท ะบะปะฐััะตัั / k8s pods
- Stateless ัะตัะฒะธัั โ ะปะตะณะบะพ ะผะฐัััะฐะฑะธัะพะฒะฐัั
- Stateful โ ััะตะฑัะตั sticky sessions / sharding

---

## 2๏ธโฃ **Load Balancing ะฟะพะดัะพะดั**

### 2.1 **Round Robin**

- ะัะพััะตะนัะธะน ัะฟะพัะพะฑ โ ะทะฐะฟัะพัั ะธะดัั ะฟะพ ะพัะตัะตะดะธ ะฝะฐ ะฒัะต ัะตัะฒะตัั
- ะะพะดัะพะดะธั ะดะปั ะพะดะฝะพัะพะดะฝัั ัะตัะฒะตัะพะฒ, ะฟัะพััะพะน ััะตะฝะฐัะธะน

### 2.2 **Least Connections**

- LB ะฝะฐะฟัะฐะฒะปัะตั ะทะฐะฟัะพั ะฝะฐ ัะตัะฒะตั ั ะฝะฐะธะผะตะฝััะธะผ ะบะพะปะธัะตััะฒะพะผ ะฐะบัะธะฒะฝัั ัะพะตะดะธะฝะตะฝะธะน
- ะญััะตะบัะธะฒะฝะตะต ะฟัะธ ัะฐะทะฝะพะน ะดะปะธัะตะปัะฝะพััะธ ะพะฑัะฐะฑะพัะบะธ ะทะฐะฟัะพัะพะฒ

### 2.3 **IP Hash / Sticky Session**

- ะะฐะถะดัะน ะบะปะธะตะฝั ะฝะฐะฟัะฐะฒะปัะตััั ะฝะฐ ะพะดะธะฝ ะธ ัะพั ะถะต ัะตัะฒะตั
- ะัะถะฝะพ ะดะปั stateful ัะตัะฒะธัะพะฒ (ะฝะฐะฟัะธะผะตั, WebSocket)

### 2.4 **Weighted Round Robin / Least Connections**

- ะฃ ัะตัะฒะตัะพะฒ ะผะพะณัั ะฑััั ัะฐะทะฝัะต ัะตััััั โ ะฒะตั ะดะปั ะฑะพะปะตะต ะผะพัะฝัั ะผะฐัะธะฝ

---

## 3๏ธโฃ **Scaling Patterns ะฒ System Design**

### 3.1 **Vertical Scaling (Scale Up)**

- - ะัะพััะฐั ัะตะฐะปะธะทะฐัะธั
- โ ะะณัะฐะฝะธัะตะฝะพ ัะตััััะฐะผะธ ะผะฐัะธะฝั
- โ Single point of failure

### 3.2 **Horizontal Scaling (Scale Out)**

- - ะะฐัััะฐะฑะธััะตะผะพััั ะฟะพััะธ ะฑะตะท ะพะณัะฐะฝะธัะตะฝะธะน
- - ะััะพะบะฐั ะดะพัััะฟะฝะพััั
- โ ะกะปะพะถะฝะตะต orchestration ะธ state management

**ะัะธะผะตั NestJS:**

- ะะปะฐััะตัะธะทะฐัะธั ัะตัะตะท PM2 ะธะปะธ Node.js Cluster module
- ะะตัะบะพะปัะบะพ podโะพะฒ ะฒ Kubernetes ั HPA (Horizontal Pod Autoscaler)

---

## 4๏ธโฃ **Stateless vs Stateful ัะตัะฒะธัั**

| ะขะธะฟ       | LB ะฟะพะดัะพะด                      | ะะฐัััะฐะฑะธัะพะฒะฐะฝะธะต                                      |
| --------- | ------------------------------ | ---------------------------------------------------- |
| Stateless | Round-robin, Least-connections | Scale out ะปะตะณะบะพ, ะปัะฑะพะน pod ะผะพะถะตั ะพะฑัะฐะฑะฐััะฒะฐัั ะทะฐะฟัะพั |
| Stateful  | Sticky session / Session store | ะัะถะตะฝ external session store (Redis) ะธะปะธ sticky LB   |

**ะัะธะผะตั WebSocket / chat-ัะตัะฒะธั:**

- LB ั sticky session โ ะบะปะธะตะฝั ะพััะฐัััั ะฝะฐ ะพะดะฝะพะผ pod
- Redis Pub/Sub โ ัะธะฝััะพะฝะธะทะฐัะธั ัะพะพะฑัะตะฝะธะน ะผะตะถะดั podโะฐะผะธ

---

## 5๏ธโฃ **ะัะพะดะฐะบัะตะฝ Best Practices**

1. **Health checks** โ LB ะฝะฐะฟัะฐะฒะปัะตั ััะฐัะธะบ ัะพะปัะบะพ ะฝะฐ ะถะธะฒัะต ะฝะพะดั
2. **Autoscaling** โ ะฒะตััะธะบะฐะปัะฝะพะต + ะณะพัะธะทะพะฝัะฐะปัะฝะพะต, ะฟะพ CPU/RAM ะธะปะธ custom metrics
3. **Circuit Breakers + Retry** โ ะทะฐัะธัะฐ ะฟัะธ ะฟะตัะตะณััะทะบะต
4. **Session management** โ stateless + external cache (Redis, Memcached)
5. **Backpressure handling** โ ะฟัะธ spike ะฝะฐะณััะทะบะต LB ะฝะต ะดะพะปะถะตะฝ ะฟะตัะตะณััะถะฐัั backend

---

## 6๏ธโฃ **ะัะธะผะตั ะฐััะธัะตะบัััั ั Load Balancer ะธ Scaling**

```
                  โโโโโโโโโโโโโโโ
                  โ   Clients   โ
                  โโโโโโโฌโโโโโโโโ
                        โ
                  โโโโโโโผโโโโโโโโ
                  โ  LoadBalancerโ
                  โโโโโโโฌโโโโโโโโ
        โโโโโโโโโโโโโโโโโดโโโโโโโโโโโโโโโโ
        โผ                               โผ
  โโโโโโโโโโโโ                     โโโโโโโโโโโโ
  โ NodeJS   โ                     โ NodeJS   โ
  โ Service  โ                     โ Service  โ
  โ Pod 1    โ                     โ Pod 2    โ
  โโโโโโโโโโโโ                     โโโโโโโโโโโโ
        โ                               โ
        โโโโโโโโโโโ          โโโโโโโโโโโ
                  โผ          โผ
                โโโโโโโโโโโโโโโโโ
                โ   Redis / DB  โ
                โโโโโโโโโโโโโโโโโ
```

- LB ัะฐัะฟัะตะดะตะปัะตั ะทะฐะฟัะพัั ะฝะฐ NodeJS ัะตัะฒะธัั
- Pods ะผะฐัััะฐะฑะธัััััั ะณะพัะธะทะพะฝัะฐะปัะฝะพ
- Redis ะธัะฟะพะปัะทัะตััั ะดะปั session/state sharing ะธ Pub/Sub (WebSocket, queues)

---

## 7๏ธโฃ **ะงัะพ ะฝะฐ ัะพะฑะตัะต ะพะฑัะทะฐัะตะปัะฝะพ ัะฟัะพััั**

1. **ะะฐะทะปะธัะธะต vertical vs horizontal scaling**
2. **ะะฐะบ ัะฐัะฟัะตะดะตะปััั ะฝะฐะณััะทะบั ะผะตะถะดั Node.js ัะตัะฒะธัะฐะผะธ**
3. **ะะฐะบ ะผะฐัััะฐะฑะธัะพะฒะฐัั stateful vs stateless ัะตัะฒะธัั**
4. **ะะฐะบะธะต LB ะฐะปะณะพัะธัะผั ะธัะฟะพะปัะทะพะฒะฐัั ะดะปั WebSocket ะธ REST**
5. **ะงัะพ ะดะตะปะฐัั ะฟัะธ spike ััะฐัะธะบะฐ / ะฟะตัะตะณััะทะบะต**
6. **ะะฐะบ ะผะพะฝะธัะพัะธัั ะธ ะพัะปะฐะถะธะฒะฐัั LB + autoscaling**
