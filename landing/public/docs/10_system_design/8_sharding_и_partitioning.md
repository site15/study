# üß† Sharding vs Partitioning ‚Äî –±–∞–∑–æ–≤–æ–µ –ø–æ–Ω–∏–º–∞–Ω–∏–µ

–í **System Design** —á–∞—Å—Ç–æ –Ω—É–∂–Ω–æ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –∏ —Ç—Ä–∞—Ñ–∏–∫. –î–ª—è —ç—Ç–æ–≥–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç:

- **Partitioning** ‚Äî –¥–µ–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –≤–Ω—É—Ç—Ä–∏ –æ–¥–Ω–æ–π –±–∞–∑—ã –∏–ª–∏ —Å–∏—Å—Ç–µ–º—ã –Ω–∞ –ª–æ–≥–∏—á–µ—Å–∫–∏–µ —Å–µ–≥–º–µ–Ω—Ç—ã.
- **Sharding** ‚Äî –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ –¥–µ–ª–µ–Ω–∏–µ –±–∞–∑—ã –Ω–∞ –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–µ —ç–∫–∑–µ–º–ø–ª—è—Ä—ã (—à–∞—Ä–¥—ã), –∫–∞–∂–¥—ã–π —Å–æ —Å–≤–æ–µ–π —á–∞—Å—Ç—å—é –¥–∞–Ω–Ω—ã—Ö.

> –ì–ª–∞–≤–Ω–æ–µ: **Sharding = Partitioning –Ω–∞ —É—Ä–æ–≤–Ω–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Å–µ—Ä–≤–µ—Ä–æ–≤**. Partitioning –º–æ–∂–µ—Ç –±—ã—Ç—å –ª–æ–≥–∏—á–µ—Å–∫–æ–π, –Ω–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–π.

---

## 1Ô∏è‚É£ **Partitioning (–ü–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ)**

**–ß—Ç–æ —ç—Ç–æ:**

- –î–∞–Ω–Ω—ã–µ –≤–Ω—É—Ç—Ä–∏ —Ç–∞–±–ª–∏—Ü—ã –¥–µ–ª—è—Ç—Å—è –Ω–∞ —Å–µ–≥–º–µ–Ω—Ç—ã –ø–æ –∫–ª—é—á—É.
- –ú–æ–∂–µ—Ç –±—ã—Ç—å **range partitioning, hash partitioning, list partitioning**.
- –û–±—ã—á–Ω–æ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤–Ω—É—Ç—Ä–∏ –æ–¥–Ω–æ–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö.

**–ü—Ä–∏–º–µ—Ä—ã:**

| –¢–∏–ø   | –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç                      | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ                      |
| ----- | --------------------------------- | ---------------------------------- |
| Range | –ù–∞–ø—Ä–∏–º–µ—Ä, –ø–æ –¥–∞—Ç–µ ‚Üí Jan, Feb, Mar | –ê—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∏–µ, –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ |
| Hash  | hash(userId) % 4 ‚Üí 4 partitions   | –†–∞–≤–Ω–æ–º–µ—Ä–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏ |
| List  | –°–ø–∏—Å–æ–∫ –∑–Ω–∞—á–µ–Ω–∏–π                   | –°—Ç–∞—Ç—É—Å—ã –∑–∞–∫–∞–∑–æ–≤, —Ä–µ–≥–∏–æ–Ω—ã           |

**Node.js/NestJS –ø—Ä–∏–º–µ—Ä:**

```ts
// –∑–∞–ø—Ä–æ—Å –≤ Postgres partitioned table
SELECT * FROM orders PARTITION FOR (userId % 4);
```

**–ü—Ä–æ–¥–∞–∫—à–µ–Ω:**

- –ü–æ–∑–≤–æ–ª—è–µ—Ç —É—Å–∫–æ—Ä–∏—Ç—å –ø–æ–∏—Å–∫ / –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –±–æ–ª—å—à–∏—Ö —Ç–∞–±–ª–∏—Ü–∞—Ö
- –õ–µ–≥—á–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å –∞—Ä—Ö–∏–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

---

## 2Ô∏è‚É£ **Sharding (–®–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏–µ)**

**–ß—Ç–æ —ç—Ç–æ:**

- –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ –¥–µ–ª–µ–Ω–∏–µ **–±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –Ω–∞ –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–µ —ç–∫–∑–µ–º–ø–ª—è—Ä—ã**
- –ö–∞–∂–¥—ã–π —à–∞—Ä–¥ —Ö—Ä–∞–Ω–∏—Ç —Ç–æ–ª—å–∫–æ —á–∞—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö
- –ß–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è **–º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–æ–≤ –∏ high-load —Å–∏—Å—Ç–µ–º**

**–¢–∏–ø—ã —à–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏—è:**

| –¢–∏–ø             | –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç                         | –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ                      |
| --------------- | ------------------------------------ | ------------------------------- |
| Hash-based      | hash(userId) % N ‚Üí shard             | –ß–∞—Ç-—Å–∏—Å—Ç–µ–º—ã, —Å–æ—Ü—Å–µ—Ç–∏, user data |
| Range-based     | userId < 1M ‚Üí shard1, 1M-2M ‚Üí shard2 | –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ, —Å–æ–±—ã—Ç–∏—è            |
| Directory-based | lookup table ‚Üí shard                 | –†–µ–¥–∫–∏–µ —Å–ª—É—á–∞–∏, –≥–∏–±–∫–∏–π –∫–æ–Ω—Ç—Ä–æ–ª—å  |

**Node.js/NestJS –ø—Ä–∏–º–µ—Ä:**

```ts
const shardId = hash(userId) % numberOfShards;
const db = dbPool[shardId];
await db.query("SELECT * FROM orders WHERE userId = $1", [userId]);
```

**–ü—Ä–æ–¥–∞–∫—à–µ–Ω:**

- –ü–æ–∑–≤–æ–ª—è–µ—Ç –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞—Ç—å –±–∞–∑—ã
- –°–Ω–∏–∂–µ–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ –æ–¥–∏–Ω —Å–µ—Ä–≤–µ—Ä
- –£–º–µ–Ω—å—à–µ–Ω–∏–µ latency –ø—Ä–∏ –±–æ–ª—å—à–æ–º –æ–±—ä—ë–º–µ –¥–∞–Ω–Ω—ã—Ö

---

## 3Ô∏è‚É£ **Sharding vs Partitioning**

| –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞  | Partitioning                | Sharding                            |
| --------------- | --------------------------- | ----------------------------------- |
| Scope           | –í–Ω—É—Ç—Ä–∏ –æ–¥–Ω–æ–π –±–∞–∑—ã           | –ù–µ—Å–∫–æ–ª—å–∫–æ –±–∞–∑ / —Å–µ—Ä–≤–µ—Ä–æ–≤            |
| –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ | –í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ–µ / –ª–æ–≥–∏—á–µ—Å–∫–æ–µ   | –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ                      |
| –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ      | –£–ª—É—á—à–µ–Ω–∏–µ –ø–æ–∏—Å–∫–∞, –∞—Ä—Ö–∏–≤–∞—Ü–∏—è | High-load, –º–∏–ª–ª–∏–æ–Ω—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π   |
| –°–ª–æ–∂–Ω–æ—Å—Ç—å       | –ù–∏–∑–∫–∞—è / —Å—Ä–µ–¥–Ω—è—è            | –í—ã—Å–æ–∫–∞—è, —Ç—Ä–µ–±—É–µ—Ç routing, directory |

---

## 4Ô∏è‚É£ **–ö–ª—é—á–µ–≤—ã–µ –º–æ–º–µ–Ω—Ç—ã –¥–ª—è System Design —Å–æ–±–µ—Å–∞**

1. **–í—ã–±–æ—Ä –∫–ª—é—á–∞ —à–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏—è**

   - –î–æ–ª–∂–µ–Ω —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è—Ç—å –Ω–∞–≥—Ä—É–∑–∫—É
   - –ü—Ä–∏–º–µ—Ä: userId, tenantId

2. **–ü—Ä–æ–±–ª–µ–º—ã cross-shard queries**

   - –ó–∞–ø—Ä–æ—Å—ã –ø–æ –Ω–µ—Å–∫–æ–ª—å–∫–∏–º —à–∞—Ä–¥–æ–º ‚Üí —Å–ª–æ–∂–Ω–µ–µ / –º–µ–¥–ª–µ–Ω–Ω–µ–µ
   - –ß–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç **aggregator service** –∏–ª–∏ **event-driven —Ä–µ–ø–ª–∏–∫–∏**

3. **–†–µ–ø–ª–∏–∫–∞—Ü–∏—è**

   - –ö–∞–∂–¥—ã–π —à–∞—Ä–¥ ‚Üí primary + replicas
   - –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å

4. **Eventual Consistency**

   - –®–∞—Ä–¥—ã —á–∞—Å—Ç–æ –∏–º–µ—é—Ç **event-driven sync**
   - –ü—Ä–∏–º–µ—Ä: chat-service ‚Üí —Å–æ–æ–±—â–µ–Ω–∏—è ‚Üí sharded DB

5. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**

   - –°–ª–µ–¥–∏—Ç—å –∑–∞ –Ω–∞–≥—Ä—É–∑–∫–æ–π –Ω–∞ —à–∞—Ä–¥
   - Hot shard ‚Üí –Ω—É–∂–Ω–æ –ø–µ—Ä–µ—Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ

---

## 5Ô∏è‚É£ **–†–µ–∞–ª—å–Ω—ã–π –ø—Ä–æ–¥–∞–∫—à–µ–Ω –ø—Ä–∏–º–µ—Ä**

**–ß–∞—Ç-—Å–∏—Å—Ç–µ–º–∞:**

- 100 –º–ª–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- **Sharding:** userId % 32 ‚Üí 32 —à–∞—Ä–¥–∞ –±–∞–∑—ã —Å–æ–æ–±—â–µ–Ω–∏–π
- **Partitioning:** –∫–∞–∂–¥–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤–Ω—É—Ç—Ä–∏ —à–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã –ø–æ –¥–∞—Ç–µ (range)
- **–ö—ç—à:** Redis ‚Üí –ø–æ—Å–ª–µ–¥–Ω–∏–µ 100 —Å–æ–æ–±—â–µ–Ω–∏–π –¥–ª—è –∫–∞–∂–¥–æ–≥–æ userId
- **Kafka:** –¥–ª—è —Å–æ–±—ã—Ç–∏–π ¬´–Ω–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ¬ª, –æ–±—Ä–∞–±–æ—Ç–∫–∞ async

**Node.js/NestJS integration:**

```ts
const shardId = hash(userId) % 32;
const db = dbPool[shardId];
const recentMessages = await db.query(
  "SELECT * FROM messages WHERE userId = $1 ORDER BY createdAt DESC LIMIT 100",
  [userId]
);
```

---

## üîπ –ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è—Ç –Ω–∞ —Å–æ–±–µ—Å–µ

- –†–∞–∑–Ω–∏—Ü–∞ –º–µ–∂–¥—É Partitioning –∏ Sharding
- –ö–∞–∫ –≤—ã–±—Ä–∞—Ç—å –∫–ª—é—á —à–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏—è
- –ö–∞–∫ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å cross-shard queries
- Trade-offs: latency vs availability vs consistency
- –û–ø—ã—Ç –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –≤—ã—Å–æ–∫–æ–Ω–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º–∞—Ö
